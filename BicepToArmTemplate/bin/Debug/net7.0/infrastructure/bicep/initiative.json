{
  "$schema": "https://schema.management.azure.com/schemas/2018-05-01/subscriptionDeploymentTemplate.json#",
  "languageVersion": "2.0",
  "contentVersion": "1.0.0.0",
  "metadata": {
    "_generator": {
      "name": "bicep",
      "version": "0.26.54.24096",
      "templateHash": "592697896758573355"
    }
  },
  "definitions": {
    "PolicySet": {
      "type": "object",
      "properties": {
        "initiativeName": {
          "type": "string"
        },
        "displayName": {
          "type": "string"
        },
        "category": {
          "type": "string"
        },
        "version": {
          "type": "string"
        },
        "policyToInclude": {
          "type": "array",
          "items": {
            "type": "string"
          }
        },
        "description": {
          "type": "string"
        }
      },
      "metadata": {
        "__bicep_imported_from!": {
          "sourceTemplate": "../types/types.bicep"
        }
      }
    }
  },
  "parameters": {
    "policySet": {
      "$ref": "#/definitions/PolicySet"
    },
    "location": {
      "type": "string"
    }
  },
  "resources": {
    "policySetDef": {
      "type": "Microsoft.Authorization/policySetDefinitions",
      "apiVersion": "2021-06-01",
      "name": "[parameters('policySet').initiativeName]",
      "properties": {
        "copy": [
          {
            "name": "policyDefinitions",
            "count": "[length(parameters('policySet').policyToInclude)]",
            "input": {
              "parameters": {},
              "policyDefinitionId": "[parameters('policySet').policyToInclude[copyIndex('policyDefinitions')]]",
              "policyDefinitionReferenceId": ""
            }
          }
        ],
        "description": "[parameters('policySet').description]",
        "displayName": "[parameters('policySet').displayName]",
        "metadata": {
          "category": "[parameters('policySet').category]",
          "version": "[parameters('policySet').version]"
        },
        "parameters": {},
        "policyType": "Custom"
      }
    }
  }
}