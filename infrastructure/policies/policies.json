{
  "definitions": [
    {
      "properties": {
        "name": "RequireTag-ResourceGroup-Environment",
        "displayName": "Require Tag (Resource Group) - Environment",
        "description": "Requires that all resource groups have an environment tag.",
        "mode": "All",
        "metadata": {
          "category": "Tags"
        }
      },
      "roles": [
        "Tag Contributor"
      ],
      "rules": {
        "if": {
          "allOf": [
            {
              "field": "type",
              "equals": "Microsoft.Resources/subscriptions/resourceGroups"
            },
            {
              "field": "tags['Environment']",
              "notIn": "[parameters('allowedValues')]"
            }
          ]
        },
        "then": {
          "effect": "deny"
        }
      },
      "parameters": {
        "allowedValues": {
          "type": "Array",
          "metadata": {
            "displayName": "Allowed Values",
            "description": "The allowed values for this tag."
          },
          "allowedValues": [
            "Live",
            "Testing",
            "UAT",
            "QAT",
            "Demo",
            "Experiment"
          ],
          "defaultValue": [
            "Live",
            "Testing",
            "UAT",
            "QAT",
            "Demo",
            "Experiment"
          ]
        }
      }
    },
    {
      "properties": {
        "name": "Require-Cap-ApplicationInsights",
        "displayName": "Require A Cap On ApplicationInsights",
        "description": "A cap must be set on application insights so that we do not cause unnecessary costs",
        "mode": "All",
        "metadata": {
          "category": "Tags"
        }
      },
      "roles": [],
      "rules": {
        "if": {
          "allOf": [
            {
              "field": "type",
              "equals": "Microsoft.OperationalInsights/workspaces"
            },
            {
              "field": "Microsoft.OperationalInsights/workspaces/workspaceCapping.dailyQuotaGb",
              "equals": "-1"
            }
          ]
        },
        "then": {
          "effect": "deny"
        }
      },
      "parameters": {
      }
    },
    {
      "properties": {
        "name": "RequireTag-ResourceGroup-Scale",
        "displayName": "Require Tag (Resource Group) - Scale",
        "description": "Requires that scalable resources have a scale tag.",
        "mode": "All",
        "metadata": {
          "category": "Tags"
        }
      },
      "roles": [
        "Tag Contributor"
      ],
      "rules": {
        "if": {
          "allOf": [
            {
              "anyOf": [
                {
                  "field": "type",
                  "equals": "Microsoft.Web/serverFarms"
                }
              ]
            },
            {
              "field": "tags['Scale']",
              "notIn": [
                "Normal",
                "Temporary"
              ]
            }
          ]
        },
        "then": {
          "effect": "deny"
        }
      },
      "parameters": {
      }
    },
    {
      "properties": {
        "name": "Cosmos-Multiple-Write-Locations",
        "displayName": "Multiple Write Locations",
        "description": "Enabling multiple write locations can cause extra charges make sure a limit is set",
        "mode": "Indexed",
        "metadata": {
          "category": "Cosmos"
        }
      },
      "roles": [
        "Tag Contributor"
      ],
      "rules": {
        "if": {
          "allOf": [
            {
              "field": "type",
              "equals": "Microsoft.DocumentDB/databaseAccounts"
            },
            {
              "field": "Microsoft.DocumentDB/databaseAccounts/enableMultipleWriteLocations",
              "exists": true
            },
            {
              "field": "Microsoft.DocumentDB/databaseAccounts/enableMultipleWriteLocations",
              "notEquals": false
            }
          ]
        },
        "then": {
          "effect": "deny"
        }
      },
      "parameters": {
      }
    },
    {
      "properties":{
        "name": "Require-ResourceGroup-Owner",
        "displayName": "Require Tag (Resource Group) - Owner",
        "description": "Requires that all resources have the Owner tag.",
        "mode": "All",
        "metadata": {
          "category": "Tags"
        }
      },
      "roles": [
        "Tag Contributor"
      ],
      "rules": {
        "if": {
          "field": "tags['Owner']",
          "exists": "false"
        },
        "then": {
          "effect": "deny"
        }
      },
      "parameters": {
      }
    }
  ]
}